# t TEST FOR THE DIFFERENCE IN 2 MEANS, INDEPENDENT SAMPLES 


```{r global_options, include=FALSE}
# set global chunk options...  
#  this changes the defaults so you don't have to repeat yourself
knitr::opts_chunk$set(comment     = NA,
                      cache       = TRUE,
                      echo        = TRUE, 
                      warning     = FALSE, 
                      message     = FALSE)
```



## Required Packages 

```{r load_libraries}
library(tidyverse)    # Loads several very helpful 'tidy' packages
library(haven)        # Read in SPSS datasets
library(car)          # Companion for Applied Regression (and ANOVA)
```




## Example Dataset - Cancer Experiment 

The `Cancer` dataset was introduced in "t TEST FOR THE MEAN OF 1 SAMPLE".



```{r}
cancer_raw <- haven::read_spss("https://raw.githubusercontent.com/CEHS-research/eBook_ANOVA/master/data/Cancer.sav")

tibble::glimpse(cancer_raw)
```

```{r}
cancer_clean <- cancer_raw %>% 
  dplyr::rename_all(tolower) %>% 
  dplyr::mutate(id = factor(id)) %>% 
  dplyr::mutate(trt = factor(trt,
                             labels = c("Placebo", 
                                        "Aloe Juice"))) %>% 
  dplyr::mutate(stage = factor(stage))

tibble::glimpse(cancer_clean)
```

```{r}
psych::headTail(cancer_clean)
```




## Eyeball method

**Do the two groups, treatment and control, have different oral conditions at initial observation?**

Judge any difference in centers (means) within the context of the  within  group spread (stadard deviation/variance)



### Means and SDs

```{r}
cancer_clean %>% 
  dplyr::group_by(trt) %>% 
  furniture::table1(totalcin, totalcw4,
                    na.rm = FALSE)
```


### Stacked Histograms

#### Baseline Oral Condition

```{r}
cancer_clean %>% 
  ggplot(aes(totalcin)) +
  geom_histogram(bins = 10) +
  facet_grid(trt ~ .)
```


#### Four Weeks Oral Condition

```{r}
cancer_clean %>% 
  ggplot(aes(totalcw4)) +
  geom_histogram(bins = 10) +
  facet_grid(trt ~ .)
```


### Side-by-Side Boxplots

#### Baseline Oral Condition

```{r}
cancer_clean %>% 
  ggplot(aes(x = trt,
             y = totalcin)) +
  geom_boxplot()
```



#### Four Weeks Oral Condition

```{r}
cancer_clean %>% 
  ggplot(aes(x = trt,
             y = totalcw4)) +
  geom_boxplot()
```

## Formal Statistical Test

### Assumption (1): Two Samples are Indepdented, Simple-Random Samples

Can not check statistically.  Can only ensure through good sampling.


### Assumption (2): Two Populations are Normaly Distributed

The first assumption to check is if the continuous variable of interest (dependent variable, DV, or outcome) is NORMALLY approximately distributed within each sample.  This is best done visually with a histogram (above) or a  quantile-quantile plot (below).  On the QQ plot, a normally distributed sample will have all the data points along a straight diagnoal line.  

#### Baseline Oral Condition

```{r}
cancer_clean %>% 
  ggplot(aes(sample = totalcin)) +
  geom_qq() +
  stat_qq_line() +
  facet_grid(. ~ trt)
```



#### Four Weeks Oral Condition


```{r}
cancer_clean %>% 
  ggplot(aes(sample = totalcw4)) +
  geom_qq() +
  stat_qq_line() +
  facet_grid(. ~ trt)
```




### Assumption (2): Two Populations exhibit Homogeneity of Variance (HOV)

Before performing the $t$ test, check to see if the assumption of homogeneity of variance is met using **Levene's Test**.  For a independent samples `t`-test for means, the groups need to have the same amount of spread (SD) in the measure of interest.

```{block type='rmdlightbulb', echo=TRUE}
Use the `car:leveneTest()` function tests the HOV assumtion.  

Inside the funtion you need to specify at least three options (sepearated by commas):

* the formula:  `continuous_var ~ grouping_var` (replace with your variable names)
* the dataset:  `data = .` to pipe it from above
* the center:   `center = "mean"` since we are comparing means
```


#### Baseline Oral Condition

Do the participants in the treatment and control groups have the same spread in oral condition at BASELINE?

```{r}
cancer_clean %>% 
  car::leveneTest(totalcin ~ trt,    # formula: continuous_var ~ grouping_var
                  data = .,          # pipe in the dataset
                  center = "mean")   # The default is "median"
```

> No violations of homogeneity were detected, $F(1, 23) = 2.210, p = .151$.



#### Four Weeks Oral Condition

Do the participants in the treatment and control groups have the same spread in oral condition at the FOURTH WEEK?

```{r}
cancer_clean %>% 
  car::leveneTest(totalcw4 ~ trt,    # formula: continuous_var ~ grouping_var
                  data = .,          # pipe in the dataset
                  center = "mean")   # The default is "median"
```

> No violations of homogeneity were detected, $F(1, 23) = 0, p = .995$.


### t-Test for Difference in Means

```{block type='rmdlightbulb', echo=TRUE}
Use the same `t.test()` funtion we have used for a single sample, but speficy a few more options.

**Inside the funtion you need to specify at least three options (sepearated by commas):**
 
* the formula:  `continuous_var ~ grouping_var` (replace with your variable names)    
* the dataset:  `data = .` to pipe it from above    


**You MAY need/want to specify some or all of the following options you may way to leave as the default or override:**

* HOV assumed:  
    + `var.equal = FALSE` **Default** Seperate-Variance test using Welch's df    
    + `var.equal = TRUE`  Pooled-Variance test *(if HOV is NOT violated)*


* Number of tails:    
    + `alternative = "two.sided"` **Default** Allows for a 2-sided alternative 
    + `alternative = "less"` Only Allows $H_0: \mu_1 - \mu_2 < 0$
    + `alternative = "more` Only Allows $H_0: \mu_1 - \mu_2 > 0$
    
    
* Independent vs. paired:    
    + `paired = FALSE`  **Default** Conducts an INDEOENDENT groups t-Test    
    + `paired = TRUE`   Conducts a PAIRED meausres t-Test 
    
    
* Confidence level:   
    + `conf.level = 0.95` **Default** Computes the 95% confidence inverval    
    + `conf.level = 0.90`  Changes to a 90% confidence interval
```


#### Baseline Oral Condition

Do the participants in the treatment group have a different average oral condition at BASELINE, compared to the control group?

```{r}
# Minimal syntax
cancer_clean %>% 
  t.test(totalcin ~ trt,   # formula: continuous_var ~ grouping_var
         data = .,         # pipe in the dataset
         var.equal = TRUE) # HOV was violated (option = TRUE)
```

> No evidence of a differnece in mean oral condition at baseline, $t(23) = 0.186, p = .854$.





#### Four Weeks Oral Condition


Do the participants in the treatment group have a different average oral condition at the FOURTH WEEK, compared to the control group?

```{r}
# Fully specified function
cancer_clean %>% 
  t.test(totalcw4 ~ trt,             # formula: continuous_var ~ grouping_var
         data = .,                   # pipe in the dataset
         var.equal = TRUE,           # default: HOV was violated (option = TRUE)
         alternative = "two.sided",  # default: 2 sided (options = "less", "greater")
         paired = FALSE,             # default: independent (option = TRUE)
         conf.level = .95)           # default: 95% (option = .9, .90, ect.)
```

> No evidence of a differnece in mean oral condition at the fourth week, $t(23) = -0.350, p = .733$.


